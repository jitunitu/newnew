<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Earning App</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; }
        .container { background: rgba(255, 255, 255, 0.95); padding: 2.5rem; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 350px; }
        h2 { text-align: center; color: #333; margin-bottom: 1.5rem; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 25px; box-sizing: border-box; outline: none; transition: border-color 0.3s; }
        input:focus { border-color: #764ba2; }
        button { width: 100%; padding: 12px; background: linear-gradient(to right, #667eea, #764ba2); color: white; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; transition: transform 0.2s, box-shadow 0.2s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4); }
        .toggle { text-align: center; margin-top: 15px; font-size: 14px; }
        .toggle a { color: #764ba2; cursor: pointer; text-decoration: none; font-weight: bold; }
        .toggle a:hover { text-decoration: underline; }
        .error { color: red; text-align: center; margin-bottom: 10px; font-size: 14px; display: none; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <!-- Login Form -->
    <div id="loginForm">
        <h2>Login</h2>
        <div id="loginError" class="error"></div>
        <form onsubmit="handleLogin(event)">
            <input type="email" id="loginEmail" placeholder="Email" required>
            <input type="password" id="loginPassword" placeholder="Password" required>
            <button type="submit">Sign In</button>
        </form>
        <div class="toggle">
            Don't have an account? <a onclick="toggleForms()">Register</a>
        </div>
    </div>

    <!-- Register Form -->
    <div id="registerForm" class="hidden">
        <h2>Register</h2>
        <div id="regError" class="error"></div>
        <form onsubmit="handleRegister(event)">
            <input type="text" id="regName" placeholder="Full Name" required>
            <input type="email" id="regEmail" placeholder="Email" required>
            <input type="tel" id="regPhone" placeholder="Phone Number" required>
            <select id="regCountry" required style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 25px; outline: none; background: white;">
                <option value="IN-INR">ðŸ‡®ðŸ‡³ India (INR)</option>
                <option value="US-USD">ðŸ‡ºðŸ‡¸ USA (USD)</option>
                <option value="GB-GBP">ðŸ‡¬ðŸ‡§ UK (GBP)</option>
                <option value="AE-AED">ðŸ‡¦ðŸ‡ª UAE (AED)</option>
            </select>
            <input type="password" id="regPassword" placeholder="Password (6+ chars)" required>
            <button type="submit">Sign Up</button>
        </form>
        <div class="toggle">
            Already have an account? <a onclick="toggleForms()">Login</a>
        </div>
    </div>
</div>

<script>
    const API_URL = 'api.php';

    function toggleForms() {
        document.getElementById('loginForm').classList.toggle('hidden');
        document.getElementById('registerForm').classList.toggle('hidden');
        document.querySelectorAll('.error').forEach(el => el.style.display = 'none');
    }

    async function handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const errorDiv = document.getElementById('loginError');

        const formData = new FormData();
        formData.append('action', 'login');
        formData.append('email', email);
        formData.append('password', password);

        try {
            const res = await fetch(API_URL, { method: 'POST', body: formData });
            const text = await res.text();
            
            // Check if response is raw PHP or HTML error (Server not running PHP)
            if (text.trim().startsWith('<?php') || text.includes('<!DOCTYPE') || text.includes('Cannot POST')) {
                alert("Error: PHP is not running. Please use XAMPP or a PHP server, not just Live Server.");
                return;
            }

            let data;
            try {
                data = JSON.parse(text);
            } catch (e) {
                console.error("Server returned invalid JSON:", text);
                return;
            }

            if (data.success) {
                localStorage.setItem('user_id', data.user_id);
                window.location.href = 'dashboard.html';
            } else {
                showError(errorDiv, data.message || 'Login failed');
            }
        } catch (err) {
            console.error(err);
            showError(errorDiv, 'Connection error. Check console for details.');
        }
    }

    async function handleRegister(e) {
        e.preventDefault();
        const name = document.getElementById('regName').value;
        const email = document.getElementById('regEmail').value;
        const phone = document.getElementById('regPhone').value;
        const password = document.getElementById('regPassword').value;
        const errorDiv = document.getElementById('regError');

        const formData = new FormData();
        formData.append('action', 'register');
        formData.append('name', name);
        formData.append('email', email);
        formData.append('phone', phone);
        formData.append('country', document.getElementById('regCountry').value);
        formData.append('password', password);

        try {
            const res = await fetch(API_URL, { method: 'POST', body: formData });
            const text = await res.text();
            
            if (text.trim().startsWith('<?php') || text.includes('<!DOCTYPE') || text.includes('Cannot POST')) {
                alert("Error: PHP is not running. Please use XAMPP or a PHP server.");
                return;
            }
            
            let data;
            try {
                data = JSON.parse(text);
            } catch (e) {
                console.error("Server returned invalid JSON:", text);
                alert('Server Error: ' + text.substring(0, 200)); /
            }

            if (data.success) {
                alert('Registration successful! Please login.');
                toggleForms();
            } else {
                showError(errorDiv, data.message || 'Registration failed');
            }
        } catch (err) {
            console.error(err);
            showError(errorDiv, 'Connection error. Check console for details.');
        }
    }

    function showError(element, message) {
        element.innerText = message;
        element.style.display = 'block';
    }
</script>
</body>
</html>